<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign-In Flow Test</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .step { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        button { padding: 12px 24px; background: #4285F4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 0; }
        button:hover { background: #3367d6; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .log { font-family: monospace; white-space: pre-wrap; background: #f1f1f1; padding: 10px; border-radius: 4px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç Sign-In Flow Debug Test</h1>
    
    <div class="step">
        <h3>Step 1: Firebase Initialization</h3>
        <div id="initStatus">Checking...</div>
    </div>
    
    <div class="step">
        <h3>Step 2: Sign-In Test</h3>
        <button id="testSignIn">üöÄ Test Sign-In Process</button>
        <div id="signInStatus"></div>
    </div>
    
    <div class="step">
        <h3>Step 3: Redirect Test</h3>
        <button id="testRedirect">üîó Test Calendar Redirect</button>
        <div id="redirectStatus"></div>
    </div>
    
    <div class="step">
        <h3>Step 4: Console Logs</h3>
        <div id="logs" class="log"></div>
    </div>

    <script>
        // Capture console logs
        const logDiv = document.getElementById('logs');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDiv.textContent += '[LOG] ' + args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logDiv.textContent += '[ERROR] ' + args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        // Firebase config
        const firebaseConfig = {
            apiKey: 'AIzaSyBKxSTOlICKjzbGiD661xA9CO-Ejz6I__0',
            authDomain: 'taskloomapp.firebaseapp.com',
            projectId: 'taskloomapp',
            storageBucket: 'taskloomapp.appspot.com',
            messagingSenderId: '54579600666',
            appId: '1:54579600666:web:df54750c40d8eb54cde0a3'
        };
        
        let auth, provider;
        
        // Step 1: Initialize Firebase
        function initFirebase() {
            const statusDiv = document.getElementById('initStatus');
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                auth = firebase.auth();
                provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                statusDiv.innerHTML = '‚úÖ <strong>SUCCESS:</strong> Firebase initialized and ready';
                statusDiv.parentElement.classList.add('success');
                
                console.log('Firebase initialized successfully');
                return true;
            } catch (error) {
                statusDiv.innerHTML = '‚ùå <strong>ERROR:</strong> ' + error.message;
                statusDiv.parentElement.classList.add('error');
                console.error('Firebase init error:', error);
                return false;
            }
        }
        
        // Step 2: Test Sign-In
        function setupSignInTest() {
            document.getElementById('testSignIn').addEventListener('click', async () => {
                const button = document.getElementById('testSignIn');
                const statusDiv = document.getElementById('signInStatus');
                
                try {
                    button.disabled = true;
                    button.textContent = 'üîÑ Signing in...';
                    statusDiv.innerHTML = 'Starting Google OAuth popup...';
                    
                    console.log('Starting sign-in process...');
                    
                    const result = await auth.signInWithPopup(provider);
                    const user = result.user;
                    
                    console.log('Sign-in successful:', user.email);
                    
                    statusDiv.innerHTML = `
                        ‚úÖ <strong>SIGN-IN SUCCESS!</strong><br>
                        <strong>User:</strong> ${user.displayName}<br>
                        <strong>Email:</strong> ${user.email}<br>
                        <strong>UID:</strong> ${user.uid}
                    `;
                    statusDiv.parentElement.classList.add('success');
                    
                    button.textContent = '‚úÖ Sign-In Successful';
                    
                    // Now test redirect
                    console.log('Testing redirect in 2 seconds...');
                    setTimeout(() => {
                        testRedirect();
                    }, 2000);
                    
                } catch (error) {
                    console.error('Sign-in error:', error);
                    statusDiv.innerHTML = `‚ùå <strong>SIGN-IN FAILED:</strong><br>${error.message}`;
                    statusDiv.parentElement.classList.add('error');
                    
                    button.disabled = false;
                    button.textContent = 'üöÄ Try Sign-In Again';
                }
            });
        }
        
        // Step 3: Test Redirect
        function testRedirect() {
            const statusDiv = document.getElementById('redirectStatus');
            
            try {
                console.log('Testing redirect to calendar.html...');
                statusDiv.innerHTML = 'üîÑ Testing redirect to calendar.html...';
                
                // Test if calendar.html exists
                fetch('calendar.html')
                    .then(response => {
                        if (response.ok) {
                            console.log('calendar.html found and accessible');
                            statusDiv.innerHTML = `
                                ‚úÖ <strong>calendar.html is accessible</strong><br>
                                <small>Status: ${response.status} ${response.statusText}</small><br>
                                <a href="calendar.html" target="_blank">üîó Open calendar.html in new tab</a>
                            `;
                            statusDiv.parentElement.classList.add('success');
                            
                            // Countdown redirect
                            let countdown = 5;
                            const countdownInterval = setInterval(() => {
                                statusDiv.innerHTML += `<br>Redirecting in ${countdown}...`;
                                countdown--;
                                if (countdown <= 0) {
                                    clearInterval(countdownInterval);
                                    console.log('Performing redirect...');
                                    window.location.href = 'calendar.html';
                                }
                            }, 1000);
                            
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    })
                    .catch(error => {
                        console.error('calendar.html access error:', error);
                        statusDiv.innerHTML = `‚ùå <strong>REDIRECT FAILED:</strong><br>calendar.html not accessible: ${error.message}`;
                        statusDiv.parentElement.classList.add('error');
                    });
                    
            } catch (error) {
                console.error('Redirect test error:', error);
                statusDiv.innerHTML = `‚ùå <strong>REDIRECT TEST FAILED:</strong><br>${error.message}`;
                statusDiv.parentElement.classList.add('error');
            }
        }
        
        // Setup manual redirect test
        document.getElementById('testRedirect').addEventListener('click', testRedirect);
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Testing sign-in flow...');
            if (initFirebase()) {
                setupSignInTest();
            }
        });
    </script>
</body>
</html>
